{% extends "base.html" %}

{% block title %}Home - Samba User Manager{% endblock %}

{% block content %}
<h1>Welcome to Samba User Manager</h1>
<h2>System: {{ hostname }}</h2>
<p>Use the navigation bar above to manage Samba users.</p>

<h2>System Metrics (Live Updates)</h2>
<div id="system-metrics">
    <h3>Disk Usage</h3>
    <ul>
        <li>Total Storage: <span id="total_storage">Loading...</span> GB</li>
        <li>Used Storage: <span id="used_storage">Loading...</span> GB</li>
        <li>Free Storage: <span id="free_storage">Loading...</span> GB</li>
    </ul>

    <h3>Disk I/O</h3>
    <ul>
        <li>Read: <span id="read_bytes_per_sec">Loading...</span> MB/s</li>
        <li>Write: <span id="write_bytes_per_sec">Loading...</span> MB/s</li>
    </ul>

    <h3>Network Activity</h3>
    <ul>
        <li>Data Sent: <span id="bytes_sent_per_sec">Loading...</span> MB/s</li>
        <li>Data Received: <span id="bytes_recv_per_sec">Loading...</span> MB/s</li>
    </ul>
</div>

<script>
    async function fetchMetrics() {
        try {
            const response = await fetch("/api/system_metrics");
            const data = await response.json();

            // Update metrics in the DOM
            document.getElementById("total_storage").innerText = data.total_storage;
            document.getElementById("used_storage").innerText = data.used_storage;
            document.getElementById("free_storage").innerText = data.free_storage;
            document.getElementById("read_bytes_per_sec").innerText = data.read_bytes_per_sec.toFixed(2);
            document.getElementById("write_bytes_per_sec").innerText = data.write_bytes_per_sec.toFixed(2);
            document.getElementById("bytes_sent_per_sec").innerText = data.bytes_sent_per_sec.toFixed(2);
            document.getElementById("bytes_recv_per_sec").innerText = data.bytes_recv_per_sec.toFixed(2);
        } catch (error) {
            console.error("Error fetching system metrics:", error);
        }
    }

    // Fetch metrics every second
    setInterval(fetchMetrics, 1000);

    // Initial fetch on page load
    fetchMetrics();
</script>
{% endblock %}
